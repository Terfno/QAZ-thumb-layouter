# キーボード最下段のキーキャップの組み合わせを検討するときに便利なやつ
QAZ キーボードの設計を念頭において書いたので、そういう素振りが見えますがどんな横幅のキーボードでも検討に活用できるはずです。

## setup
rbenv で ruby 3.4.3 を指定しています。
```sh
rbenv install
```

## run
```sh
ruby gen.rb
```

これでデフォルトの設定の JSON が出てきます。
この JSON は KLE にペーストできるので、そのままコピペして使えます。

## configure
`gen.rb` の中身を部分的に変更することで任意の幅、任意の装飾キーを組み合わせることができます。

修正するのはファイル冒頭のこの部分だけです。デフォルトでは横幅 10.75 U のキーボードの最下段のキーキャップの組み合わせ一覧を出力する状態です。
```rb
# 必要に応じて変更する。
TARGET_WIDTH = 10.75 # 横幅の指定。
MAX_KEYS = 10  # 使うキーキャップの最大数。
KEY_SIZES = [1.0, 1.25, 1.5, 1.75, 2.0, 2.25, 2.75, 6.25] # 使えるキーキャップのサイズのリスト。
KEY_LIMITS = { # 使えるキーキャップの個数の制約
  1.0 => MAX_KEYS,  # 1.0 には特別な制約はない
  1.25 => 6,        # 1.25 U のキーキャップが 6 個まで
  1.5 => 1,
  1.75 => 0,        # 1.75 U のキーキャップは使わない
  2.0 => 1,
  2.25 => 2,
  2.75 => 1,
  6.25 => 1
}.freeze
```

たとえば↓のように書き換えれば横幅 11 U のキーボードの最下段のキーキャップの組み合わせ一覧を出力するようになります。
```rb
# 必要に応じて変更する。
TARGET_WIDTH = 11 # 横幅の指定。
MAX_KEYS = 10  # 使うキーキャップの最大数。
KEY_SIZES = [1.0, 1.25, 1.5, 1.75, 2.0, 2.25, 2.75, 6.25] # 使えるキーキャップのサイズのリスト。
KEY_LIMITS = { # 使えるキーキャップの個数の制約
  1.0 => MAX_KEYS,  # 1.0 には特別な制約はない
  1.25 => 5,        # 1.25 U のキーキャップが 5 個まで
  1.5 => 0,         # 1.5 U のキーキャップは使わない
  1.75 => 0,        # 1.75 U のキーキャップは使わない
  2.0 => 0,         # 2.0 U のキーキャップは使わない
  2.25 => 2,
  2.75 => 1,
  6.25 => 1
}.freeze
```

それなりに高速なアルゴリズムを書いたつもりですが、横幅が広くなるほど遅くなるはずです。

### 出力例
デフォルトの状態の出力例を一部抜粋します↓
```json
["Q", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.5}, "Tab \n 1.5U", {w: 2.0}, "Backspace \n 2U"],
["Q", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 2.0}, "Backspace \n 2U", {w: 2.75}, "Shift \n 2.75U"],
["Q", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.5}, "Tab \n 1.5U", {w: 2.25}, "Shift \n 2.25U", {w: 2.25}, "Enter \n 2.25U"],
["Q", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 2.25}, "Shift \n 2.25U", {w: 2.25}, "Enter \n 2.25U", {w: 2.75}, "Shift \n 2.75U"],
["Q", {w: 1.25}, "Mod \n 1.25U", {w: 1.5}, "Tab \n 1.5U", {w: 2.0}, "Backspace \n 2U", {w: 2.25}, "Shift \n 2.25U", {w: 2.75}, "Shift \n 2.75U"],
["Q", {w: 1.25}, "Mod \n 1.25U", {w: 2.25}, "Shift \n 2.25U", {w: 6.25}, "Space \n 6.25U"],
["Q", {w: 1.5}, "Tab \n 1.5U", {w: 2.0}, "Backspace \n 2U", {w: 6.25}, "Space \n 6.25U"],
[{w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 2.25}, "Shift \n 2.25U", {w: 2.25}, "Enter \n 2.25U"],
[{w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.5}, "Tab \n 1.5U", {w: 2.0}, "Backspace \n 2U", {w: 2.25}, "Shift \n 2.25U"],
[{w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 2.0}, "Backspace \n 2U", {w: 2.25}, "Shift \n 2.25U", {w: 2.75}, "Shift \n 2.75U"],
[{w: 1.25}, "Mod \n 1.25U", {w: 1.25}, "Mod \n 1.25U", {w: 2.0}, "Backspace \n 2U", {w: 6.25}, "Space \n 6.25U"],
[{w: 1.5}, "Tab \n 1.5U", {w: 2.0}, "Backspace \n 2U", {w: 2.25}, "Shift \n 2.25U", {w: 2.25}, "Enter \n 2.25U", {w: 2.75}, "Shift \n 2.75U"],
[{w: 2.25}, "Shift \n 2.25U", {w: 2.25}, "Enter \n 2.25U", {w: 6.25}, "Space \n 6.25U"],
```

KLE (Keyboard Layout Editor) にペーストしてみるとこんな感じになります↓
<img width="653" alt="KLE での表示" src="https://github.com/user-attachments/assets/a96ea8f1-eb19-4668-acf1-7f6f2c9377cb" />
